-- DROP szekció (újrafuttatás esetére)
BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE HONNAN CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE HOVA CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE MEGVETT_JEGY CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE BEOSZTOTT CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE JON CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE MENETREND CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE ALLOMAS CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE FELHASZNALO CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE KALAUZ CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE JEGY CASCADE CONSTRAINTS';
EXCEPTION
    WHEN OTHERS THEN NULL;
END;
/

-- FELHASZNALO
CREATE TABLE FELHASZNALO (
    id NUMBER PRIMARY KEY,
    nev VARCHAR2(100),
    email VARCHAR2(100) UNIQUE,
    jelszo VARCHAR2(100),
    szerep VARCHAR2(50)
);

-- JEGY
CREATE TABLE JEGY (
    id NUMBER PRIMARY KEY,
    megnevezes VARCHAR2(100),
    ar NUMBER
);

-- MEGVETT_JEGY
CREATE TABLE MEGVETT_JEGY (
    id NUMBER PRIMARY KEY,
    felhasznalo_id NUMBER,
    jegy_id NUMBER,
    fizetett_ar NUMBER,
    mikor DATE,
    jaratszam NUMBER,
    CONSTRAINT fk_mj_felhasznalo FOREIGN KEY (felhasznalo_id) REFERENCES FELHASZNALO(id) ON DELETE CASCADE,
    CONSTRAINT fk_mj_jegy FOREIGN KEY (jegy_id) REFERENCES JEGY(id) ON DELETE SET NULL
);

-- KALAUZ
CREATE TABLE KALAUZ (
    id NUMBER PRIMARY KEY,
    nev VARCHAR2(100),
    ado_szam VARCHAR2(20) UNIQUE,
    szul_datum DATE,
    szul_hely VARCHAR2(100)
);

-- ALLOMAS
CREATE TABLE ALLOMAS (
    id NUMBER PRIMARY KEY,
    nev VARCHAR2(100),
    varos VARCHAR2(100)
);

-- MENETREND
CREATE TABLE MENETREND (
    id NUMBER PRIMARY KEY,
    jaratszam NUMBER,
    napok VARCHAR2(50),
    idopont TIMESTAMP
);

-- JON
CREATE TABLE JON (
    allomas_id NUMBER,
    menetrend_id NUMBER,
    sorszam NUMBER,
    PRIMARY KEY (allomas_id, menetrend_id),
    CONSTRAINT fk_jon_allomas FOREIGN KEY (allomas_id) REFERENCES ALLOMAS(id) ON DELETE CASCADE,
    CONSTRAINT fk_jon_menetrend FOREIGN KEY (menetrend_id) REFERENCES MENETREND(id) ON DELETE CASCADE
);

-- BEOSZTOTT
CREATE TABLE BEOSZTOTT (
    kalauz_id NUMBER,
    menetrend_id NUMBER,
    PRIMARY KEY (kalauz_id, menetrend_id),
    CONSTRAINT fk_beosztott_kal FOREIGN KEY (kalauz_id) REFERENCES KALAUZ(id) ON DELETE CASCADE,
    CONSTRAINT fk_beosztott_men FOREIGN KEY (menetrend_id) REFERENCES MENETREND(id) ON DELETE CASCADE
);

-- HOVA
CREATE TABLE HOVA (
    megvett_jegy_id NUMBER PRIMARY KEY,
    allomas_id NUMBER,
    CONSTRAINT fk_hova_jegy FOREIGN KEY (megvett_jegy_id) REFERENCES MEGVETT_JEGY(id) ON DELETE CASCADE,
    CONSTRAINT fk_hova_allomas FOREIGN KEY (allomas_id) REFERENCES ALLOMAS(id) ON DELETE CASCADE
);

-- HONNAN
CREATE TABLE HONNAN (
    megvett_jegy_id NUMBER PRIMARY KEY,
    allomas_id NUMBER,
    CONSTRAINT fk_honnan_jegy FOREIGN KEY (megvett_jegy_id) REFERENCES MEGVETT_JEGY(id) ON DELETE CASCADE,
    CONSTRAINT fk_honnan_allomas FOREIGN KEY (allomas_id) REFERENCES ALLOMAS(id) ON DELETE CASCADE
);

-- INSERT adatok (5-5 rekord)

-- FELHASZNALO
INSERT INTO FELHASZNALO VALUES (1, 'Kiss János', 'janos@example.com', 'pass1', 'utas');
INSERT INTO FELHASZNALO VALUES (2, 'Nagy Éva', 'eva@example.com', 'pass2', 'utas');
INSERT INTO FELHASZNALO VALUES (3, 'Tóth Béla', 'bela@example.com', 'pass3', 'admin');
INSERT INTO FELHASZNALO VALUES (4, 'Kovács Réka', 'reka@example.com', 'pass4', 'utas');
INSERT INTO FELHASZNALO VALUES (5, 'Varga Dénes', 'denes@example.com', 'pass5', 'utas');

-- JEGY
INSERT INTO JEGY VALUES (1, 'Teljes árú', 3500);
INSERT INTO JEGY VALUES (2, 'Diák', 2000);
INSERT INTO JEGY VALUES (3, 'Nyugdíjas', 1800);
INSERT INTO JEGY VALUES (4, 'Családi', 4500);
INSERT INTO JEGY VALUES (5, 'Hétvégi', 3000);

-- MEGVETT_JEGY
INSERT INTO MEGVETT_JEGY VALUES (1, 1, 2, 2000, TO_DATE('2025-03-01', 'YYYY-MM-DD'), 101);
INSERT INTO MEGVETT_JEGY VALUES (2, 2, 1, 3500, TO_DATE('2025-03-02', 'YYYY-MM-DD'), 102);
INSERT INTO MEGVETT_JEGY VALUES (3, 3, 3, 1800, TO_DATE('2025-03-03', 'YYYY-MM-DD'), 103);
INSERT INTO MEGVETT_JEGY VALUES (4, 4, 4, 4500, TO_DATE('2025-03-04', 'YYYY-MM-DD'), 104);
INSERT INTO MEGVETT_JEGY VALUES (5, 5, 5, 3000, TO_DATE('2025-03-05', 'YYYY-MM-DD'), 105);

-- KALAUZ
INSERT INTO KALAUZ VALUES (1, 'Szabó Zoltán', '123456789', TO_DATE('1980-01-01','YYYY-MM-DD'), 'Budapest');
INSERT INTO KALAUZ VALUES (2, 'Mészáros Anna', '223456789', TO_DATE('1975-02-02','YYYY-MM-DD'), 'Debrecen');
INSERT INTO KALAUZ VALUES (3, 'Fekete Gábor', '323456789', TO_DATE('1990-03-03','YYYY-MM-DD'), 'Pécs');
INSERT INTO KALAUZ VALUES (4, 'Pintér László', '423456789', TO_DATE('1985-04-04','YYYY-MM-DD'), 'Győr');
INSERT INTO KALAUZ VALUES (5, 'Oláh Katalin', '523456789', TO_DATE('1992-05-05','YYYY-MM-DD'), 'Szeged');

-- ALLOMAS
INSERT INTO ALLOMAS VALUES (1, 'Keleti', 'Budapest');
INSERT INTO ALLOMAS VALUES (2, 'Nyugati', 'Budapest');
INSERT INTO ALLOMAS VALUES (3, 'Déli', 'Budapest');
INSERT INTO ALLOMAS VALUES (4, 'Pécs', 'Pécs');
INSERT INTO ALLOMAS VALUES (5, 'Debrecen', 'Debrecen');

-- MENETREND
INSERT INTO MENETREND VALUES (1, 101, 'Hétfő-Péntek', TO_TIMESTAMP('10:00:00','HH24:MI:SS'));
INSERT INTO MENETREND VALUES (2, 102, 'Hétvége', TO_TIMESTAMP('12:00:00','HH24:MI:SS'));
INSERT INTO MENETREND VALUES (3, 103, 'Hétfő', TO_TIMESTAMP('08:30:00','HH24:MI:SS'));
INSERT INTO MENETREND VALUES (4, 104, 'Kedd', TO_TIMESTAMP('09:45:00','HH24:MI:SS'));
INSERT INTO MENETREND VALUES (5, 105, 'Péntek', TO_TIMESTAMP('14:15:00','HH24:MI:SS'));

-- JON
INSERT INTO JON VALUES (1, 1, 1);
INSERT INTO JON VALUES (2, 1, 2);
INSERT INTO JON VALUES (3, 2, 1);
INSERT INTO JON VALUES (4, 3, 1);
INSERT INTO JON VALUES (5, 4, 1);

-- BEOSZTOTT
INSERT INTO BEOSZTOTT VALUES (1, 1);
INSERT INTO BEOSZTOTT VALUES (2, 2);
INSERT INTO BEOSZTOTT VALUES (3, 3);
INSERT INTO BEOSZTOTT VALUES (4, 4);
INSERT INTO BEOSZTOTT VALUES (5, 5);

-- HOVA
INSERT INTO HOVA VALUES (1, 2);
INSERT INTO HOVA VALUES (2, 3);
INSERT INTO HOVA VALUES (3, 4);
INSERT INTO HOVA VALUES (4, 5);
INSERT INTO HOVA VALUES (5, 1);

-- HONNAN
INSERT INTO HONNAN VALUES (1, 1);
INSERT INTO HONNAN VALUES (2, 2);
INSERT INTO HONNAN VALUES (3, 3);
INSERT INTO HONNAN VALUES (4, 4);
INSERT INTO HONNAN VALUES (5, 5);
